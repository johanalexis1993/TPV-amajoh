import{p as re,a as se,g as L,s as $,t as ie,e as le,d as ce,b as de,f as ue,c as me,h as pe}from"./postHandlers-BBQPzMM3.js";import"./confirmPasword-DZ5KU0ZE.js";const N=[],ge=e=>{N.push(e),N.length===1&&requestAnimationFrame(ve)},ve=()=>{for(;N.length;)N.shift()()},H={};document.querySelectorAll("section").forEach(e=>{H[e.id]=e});const X=e=>{const n=H[e];if(!n)return console.error("La secci√≥n solicitada no existe.");for(const o in H){const a=H[o];ge(()=>a.style.display=a===n?"block":"none")}},he={agregarPlato:"agregarPlato",inventario:"inventario",caja:"caja",reservation:"reservation",list:"list",unavailablePlates:"unavailablePlates",Losses:"Losses",clientes:"clientes",orderPaid:"orderPaid",gestionPersonal:"gestionPersonal",estadisticasVentas:"estadisticasVentas",configuracionTPV:"configuracionTPV",reportesFinancieros:"reportesFinancieros",configuracionRestaurante:"configuracionRestaurante",ayuda:"ayuda"},ye=()=>{requestIdleCallback(()=>{const e=localStorage.getItem("currentSectionId")||"inventario",n=()=>{const o=window.location.hash.slice(1),a=he[o]||"inventario";X(a),localStorage.setItem("currentSectionId",a)};window.location.hash?n():X(e),window.addEventListener("hashchange",n)})};ye();document.querySelector("#menu-toggle").addEventListener("click",()=>{const e=document.querySelector("aside");e?requestAnimationFrame(()=>e.classList.toggle("hidden")):console.error("No se pudo encontrar el elemento 'aside'.")});requestIdleCallback(()=>{const e=localStorage.getItem("token");(!e||e.trim()===""||e==="undefined"||e==="null")&&window.location.replace("/index.html")});const te=e=>{const n=document.querySelector(`#${e}`),o=n.querySelectorAll('input[type="text"]').length+1,a=document.createDocumentFragment(),t=document.createElement("div");t.classList.add("divIngredient");let r=`
    <label for="name${o}">
    <input type="text" id="name${o}" name="ingredients[${o-1}][name]" required>
  <span>Ingrediente:</span>
    </label>
    <label for="amount${o}">
    <input type="number" id="amount${o}" name="ingredients[${o-1}][amount]" step="0.01" required>
  <span>Cantidad:</span>
  </label>
  `;e==="ingredientInputs"&&(r+=`
      <label>
        <select id="imgAllergies${o}" name="ingredients[${o-1}][imgAllergies]" multiple>
          <option value="" disabled selected></option>
          <option value="lupins">Altramuces</option>
          <option value="celery">Apio</option>
          <option value="sulphurDioxideAndSulphites">Azufre y sulfitos</option>
          <option value="peanuts">Cacahuetes</option>
          <option value="crustaceans">Crust√°ceos</option>
          <option value="treeNuts">Frutos de c√°scara</option>
          <option value="gluten">Gluten</option>
          <option value="eggs">Huevos</option>
          <option value="dairy">L√°cteos</option>
          <option value="molluscs">Moluscos</option>
          <option value="mustard">Mostaza</option>
          <option value="fish">Pescado</option>
          <option value="sesame">S√©samo</option>
          <option value="soja">Soja</option>
        </select>
        <span>Seleccione alergeno</span>
      </label>
    `),r+='<button type="button" class="removeIngredientBtn">Eliminar</button>',t.innerHTML=r,a.append(t),n.append(a),t.querySelector(".removeIngredientBtn").addEventListener("click",()=>t.remove())};document.querySelector("#ingredientInputs button").addEventListener("click",()=>te("ingredientInputs"));document.querySelector("#ingredientsProducts button").addEventListener("click",()=>te("ingredientsProducts"));const K=(e,n)=>{const o=document.querySelector(`#${n}`);o.innerHTML="";const a=document.createElement("ul");e&&e.length>0&&e.forEach(t=>{const r=re(t);a.append(r)}),o.append(a)},W=(e,n)=>{const o={};n.forEach(a=>{const{category:t}=a;o[t]||(o[t]=[]),o[t].push(a)}),se(o,e)},R=(e,n,o)=>{const a=document.querySelector(`#${e} tbody`),t=document.createDocumentFragment();a.innerHTML="";for(let r=0;r<o;r++){const s=document.createElement("tr");n.forEach(()=>{const i=document.createElement("td");i.textContent="Cargando...",s.append(i)}),e!=="reportesFinancieros"&&(s.append(document.createElement("td")),s.append(document.createElement("td"))),t.append(s)}a.append(t)};R("tablaInventario",["producto","cantidad","precio","maxAmount","categoria","proveedor"],20);R("tableReservation",["name","table","telephon","reservationDate","reservationTime","allergies"],20);R("tablaMerma",["wastageProduct","wastage","reason"],20);R("gestionPersonal",["name","job","telephon","salary"],20);R("clientes",["name","email","telephon"],20);const fe=(e,n)=>{switch(n){case"reservationDate":const o=new Date(e[n]);return`${o.getDate()}-${o.getMonth()+1}-${o.getFullYear()}`;case"wastageProduct":return e.wastageProduct?e.wastageProduct.producto:"No disponible";case"precio":return`${e[n]}‚Ç¨`;case"name":return e.userId?e.userId.name:e.name;case"telephon":return e.userId?e.userId.telephon:e.telephon;default:return e[n]||void 0}},_=(e,n,o)=>{const a=document.querySelectorAll(`#${e} tbody tr`),t=n.filter(r=>e==="clientes"&&r.rol==="Cliente"||e==="gestionPersonal"&&r.job||e!=="clientes"&&e!=="gestionPersonal");a.forEach((r,s)=>{const i=r.querySelectorAll("td"),c=t[s];if(!c)return r.style.display="none";if(r.style.display="",o.forEach((l,g)=>{i[g].textContent=fe(c,l)}),e!=="reportesFinancieros"){const l=i[o.length];l.dataset.id=c._id,l.style.display="none",l.textContent=c._id;const g=i[o.length+1];g.innerHTML="";const u=document.createElement("button");u.classList.add("editar"),u.textContent="Editar";const p=document.createElement("button");p.classList.add("eliminar"),p.textContent="Eliminar",g.append(u,p)}})},be=(e,n,o)=>{const a=document.getElementById(o);if(!a)return console.error(`Canvas con ID '${o}' no encontrado`);const t=a.getContext("2d"),r=window.devicePixelRatio??1;let s=document.body.querySelector(".tpv-tooltip");s||(s=document.createElement("div"),s.className="tpv-tooltip",document.body.append(s));const i=new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"});let c=null,l=0,g=[];const u=getComputedStyle(document.documentElement),p=u.getPropertyValue("--color-text")?.trim()||"#444",T=u.getPropertyValue("--color-highlight")?.trim()||"#4BC0C0",P=()=>{const d=a.parentElement.clientWidth,v=Math.max(300,window.innerHeight*.4);a.style.width=d+"px",a.style.height=v+"px",a.width=d*r,a.height=v*r,t.setTransform(r,0,0,r,0,0)},q=()=>{const d=parseFloat(getComputedStyle(document.documentElement).fontSize)||16,v=50,j=.75*d,x=Math.min(Math.max(a.width/1e3,.5),1.2),h=j*x,f=n==="day"?Array.from({length:31},(y,E)=>`${E+1}`):n==="month"?["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"]:e.map(y=>`${y.year}`),C=n==="day"?(()=>{const y=Array(31).fill(0);return e.forEach(E=>y[E.day-1]=E.totalSales),y})():n==="month"?(()=>{const y=Array(12).fill(0);return e.forEach(E=>y[E.month-1]=E.totalSales),y})():e.map(y=>y.totalSales),M=a.width/r,D=a.height/r,b=M-v*2,m=D-v*2,S=Math.max(...C)||1,F=C.length,Y=Math.min(b*.2/(F-1),16),G=(b-Y*(F-1))/F;return g=f.map((y,E)=>({x:v+E*(G+Y),width:G,label:y,value:C[E]})),{w:M,h:D,cW:b,cH:m,pad:v,maxV:S,fS:h}},I=(d,v,j,x,h,f,C)=>{t.clearRect(0,0,a.width,a.height),t.fillStyle=p,t.strokeStyle=p,t.font=`${C}px system-ui, sans-serif`,t.textBaseline="middle",t.beginPath();for(let m=0;m<=4;m++){const S=h+x*m/4;t.moveTo(h,S),t.lineTo(d-h,S),t.fillText(Math.round(f*(1-m/4)),h-35,S)}t.stroke(),t.fillStyle=T,g.forEach(m=>{const S=m.value/f*x*l,F=v-h-S;t.fillRect(m.x,F,m.width,S),m.y=F,m.height=S}),t.fillStyle=p,g.forEach(m=>{t.save(),t.translate(m.x+m.width/2,v-h+C/2),t.rotate(-Math.PI/4),t.textAlign="right",t.fillText(m.label,0,0),t.restore()}),t.font=`bold ${C*1.33}px system-ui, sans-serif`,t.fillText("Ventas Totales",d/2-60,C*1.75);const M=d-210,D=40,b=16;t.fillStyle=T,t.fillRect(M,D,b,b),t.strokeStyle=p,t.strokeRect(M,D,b,b),t.fillStyle=p,t.font=`bold ${C*1.5}px system-ui, sans-serif`,t.textAlign="left",t.fillText("Ventas Totales (‚Ç¨)",M+b+8,D+b-4)},A=d=>{I(...d),l<1&&(l+=.05,c=requestAnimationFrame(()=>A(d)))};a.onmousemove=d=>{const v=a.getBoundingClientRect(),j=d.clientX-v.left,x=d.clientY-v.top,h=g.find(f=>j>=f.x&&j<=f.x+f.width&&x>=f.y&&x<=f.y+f.height);h?(s.textContent=`${h.label}: ${i.format(h.value)}`,s.style.left=`${d.pageX+10}px`,s.style.top=`${d.pageY-30}px`,s.style.display="block",s.style.opacity="1"):(s.style.opacity="0",setTimeout(()=>s.style.display="none",150))},a.onmouseleave=()=>{s.style.opacity="0",setTimeout(()=>s.style.display="none",150)};let k=null;const oe=()=>{clearTimeout(k),k=setTimeout(()=>{l=0,P();const d=q();c&&cancelAnimationFrame(c),A(Object.values(d))},150)};new ResizeObserver(oe).observe(a.parentElement),P();const ae=q();A(Object.values(ae))},Q=(e,n,o=[],a,t=20)=>{const r=document.querySelector(`#${n}`);if(!r)return;r.innerHTML="";const s=document.createDocumentFragment();if(o.length){const l=document.createElement("h2");l.textContent=o,s.append(l)}let i=0;const c=()=>{const l=Math.min(i+t,e.length);for(let g=i;g<l;g++){const u=e[g],p=document.createElement("details"),T=document.createElement("summary"),P=document.createElement("span");P.className="icon",P.textContent=u.tipo==="pedido"?"üõí":u.tipo==="notificacion"?"üîî":u.tipo==="cocinero"?"üë®‚Äçüç≥":u.cantidad===0?"‚ùå":"üîî",P.style.fontFamily='"Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif';const q=document.createElement("span");q.className="label",q.textContent=u.producto||u.userId?.name||"Item",T.append(P," ",q),u.cantidad===0&&(T.style.backgroundColor="var(--red)"),p.dataset.id=u._id,p.append(T),a.forEach(I=>{const A=document.createElement("p");let k=u[I.toLowerCase()]||u[I];I.toLowerCase()==="reservationdate"&&(k=new Date(k).toLocaleDateString()),A.innerHTML=`<strong>${I}:</strong> ${k??"0"}`,p.append(A)}),s.append(p)}r.append(s),i=l};c(),r.addEventListener("scroll",function l(){r.scrollTop+r.clientHeight>=r.scrollHeight&&(i<e.length?c():r.removeEventListener("scroll",l))})},w=async(e,n,o,a=1,t=20)=>{try{const r=await L(`${e}?page=${a}&limit=${t}`);_(n,r,o)}catch(r){$("Error al actualizar la tabla",r)}},O=async e=>{try{const n=await L(e),{orderPaing:o,notOrderPaing:a}=n;K(a,"pedidos"),K(o,"orderPaid"),requestAnimationFrame(()=>ie())}catch(n){$("Error al obtener pedidos",n)}},V=async e=>{try{const n=await L(e,!1),{availablePlates:o,unavailablePlates:a}=n;W("unavailables",a),W("platos-lista",o)}catch(n){$("Error al obtener platos",n)}},Ee=(e,n,o,a)=>{a?o(e,n,a):o(e,n)},Ce=async(e,n,o,a,t,r=null)=>{let s;isNaN(e)?s=`${o}${e}`:s=`${a}${e}`;try{const i=await L(s);Ee(n,i,t,r)}catch(i){$("Error al buscar platos",i)}},z=(e,n,o,a,t,r=[],s=null)=>{document.querySelector(e).addEventListener("input",function(){const i=this.value.trim();i!==""?Ce(i,o,n,a,t,r):s&&s()})},Se=async(e,n)=>{let o=`${e}${n}`;try{return await L(o)}catch(a){return $("Error al buscar usuarios",a),[]}},we=async(e,n)=>{try{const o=await L(e),{productsToBuy:a,productsToPrepare:t}=o;Q(a,"shoppingList",["üõí Lista de Compra"],n),Q(t,"mealPrepList",["üë®‚Äçüç≥ Elaborar"],n)}catch(o){$("Error al obtener pedidos",o)}},Z=async(e,n)=>{try{const o=await L(e);be(o,n,"graficoVentas")}catch(o){$("Error al obtener pedidos",o)}},B=(e,n,o)=>{document.querySelector(`#${e}`).addEventListener("click",async t=>{const r=t.target,s=r.classList.contains("eliminar")?"eliminar":r.classList.contains("editar")?"editar":null;if(s){const c=r.closest("tr").querySelector("td[data-id]").dataset.id;if(s==="eliminar"){const l=await le(c,n,`#${e}`);ce(c,`#${e}`,o,l)}else s==="editar"&&await de(n,c,e,o)}})};requestIdleCallback(()=>{B("tableReservation","reservation/",{id:5,editables:[{nombre:"name",indice:0},{nombre:"table",indice:1},{nombre:"telephon",indice:2},{nombre:"reservationDate",indice:3},{nombre:"reservationTime",indice:4}]}),B("tablaInventario","productos/",{id:6,editables:[{nombre:"producto",indice:0},{nombre:"cantidad",indice:1},{nombre:"precio",indice:2},{nombre:"maxAmount",indice:3},{nombre:"categoria",indice:4},{nombre:"proveedor",indice:5}]}),B("tablaEmpleados","users/",{id:4,editables:[{nombre:"name",indice:0},{nombre:"job",indice:1},{nombre:"telephon",indice:2},{nombre:"salary",indice:3}]}),B("tablaClientes","users/",{id:3,editables:[{nombre:"name",indice:0},{nombre:"email",indice:1},{nombre:"telephon",indice:2}]}),B("tablaMerma","wasteControl/",{id:3,editables:[{nombre:"wastageProduct",indice:0},{nombre:"wastage",indice:1},{nombre:"reason",indice:2}]})});const Pe=(e,n)=>{let o=-1;const a=t=>document.querySelectorAll(".autocomplete-items").forEach(r=>t!==r&&t!==e&&r.remove());e.addEventListener("input",()=>{const t=e.value;if(a(),!t)return!1;const r=document.createElement("div");r.setAttribute("id",`${e.id}-autocomplete-list`),r.setAttribute("class","autocomplete-items"),e.parentNode.append(r),n.filter(s=>s.slice(0,t.length).toUpperCase()===t.toUpperCase()).forEach(s=>{const i=document.createElement("div");i.innerHTML=`<strong>${s.slice(0,t.length)}</strong>${s.slice(t.length)}<input type='hidden' value='${s}'>`,i.addEventListener("click",()=>{e.value=s,a()}),r.append(i)})}),e.addEventListener("keydown",t=>{let r=document.getElementById(`${e.id}-autocomplete-list`);r&&(r=r.getElementsByTagName("div")),t.keyCode===40||t.keyCode===38?(o+=t.keyCode===40?1:-1,Array.from(r).forEach((s,i)=>i===o?(s.classList.add("autocomplete-active"),e.value=s.getElementsByTagName("input")[0].value):s.classList.remove("autocomplete-active"))):t.keyCode===13&&r&&o>-1&&(t.preventDefault(),r[o].click())}),document.addEventListener("click",t=>a(t.target))};function U(e,n,o){const a=s=>{s.addEventListener("input",async function(){const i=this.value.trim();if(i!==""){const c=await Se(n,i);Pe(this,c.map(o))}})},t=document.querySelector(e);t&&a(t),new MutationObserver(s=>{for(const i of s)if(i.type==="childList"){for(const c of i.addedNodes)if(c.nodeType===1){const l=c.matches(e)?c:c.querySelector(e);l&&a(l)}}}).observe(document.body,{childList:!0,subtree:!0})}const xe=(e=[])=>{e.forEach(([n,o])=>{const a=document.querySelector(n);a?a.addEventListener("click",o):console.warn(`‚ö†Ô∏è Elemento no encontrado: ${n}`)})};requestIdleCallback(()=>{z("#plate","plate/title/","platos-lista","plate/precio/",W,[],()=>V("plate/")),z("#searchReservation","reservation/nameReservation/","tableReservation","reservation/telephonReservation/",_,["name","table","telephon","reservationDate","reservationTime","allergies"],()=>w("reservation/","tableReservation",["name","table","telephon","reservationDate","reservationTime"],1,20)),z("#product","productos/ProductByText/","tablaInventario","productos/ProductByPrice/",_,["producto","cantidad","precio","maxAmount","categoria","proveedor"],()=>w("productos/","tablaInventario",["producto","cantidad","precio","maxAmount","categoria","proveedor"],1,20)),xe([["#enlace-list",()=>we("productos/list/",["Cantidad","Precio","Categoria","Proveedor"])],["#enlace-Losses",()=>w("wasteControl/","tablaMerma",["wastageProduct","wastage","reason"],1,2)],["#enlace-gestionPersonal",()=>w("users/","gestionPersonal",["name","job","telephon","salary"],1,2)],["#enlace-clientes",()=>w("users/","clientes",["name","email","telephon"],1,2)],["#enlace-reportesFinancieros",()=>w("pedidos/salesBySource/","reportesFinancieros",["Dia","Tarjeta","Efectivo","Maquinas Recreativas","Glovo","Tienda Online","Total TPV"],1,2)],["#enlace-reservation",()=>w("reservation/","tableReservation",["name","table","telephon","reservationDate","reservationTime","allergies"],1,2)],["#enlace-caja",()=>{O("pedidos/"),setInterval(()=>O("pedidos/"),3e4),V("plate/")}],["#enlace-order",()=>{V("plate/"),O("pedidos/")}],["#enlace-estadisticasVentas",()=>Z("pedidos/salesHistory?period=day","day")]]),w("productos/","tablaInventario",["producto","cantidad","precio","maxAmount","categoria","proveedor"],1,20),document.querySelector("#selectedPeriod").addEventListener("change",n=>{const o=n.target.value;Z(`pedidos/salesHistory?period=${o}`,o)}),U("#emailContacto","users/email/",n=>n.email),U("#wastageProduct","productos/ProductByText/",n=>n.producto),U('.divIngredient [type="text"]',"productos/ProductByText/",n=>n.producto)});let J=!1;const ne=(e,n)=>{document.querySelector(e).addEventListener("click",()=>{J?(me(),pe(!1),J=!1):(ue(e,n),J=!0)})};ne("#sectionUnavailablePlates","#unavailables .has-tooltip");ne("#sectionAvailablePlates","#platos-lista .has-tooltip");document.querySelector("#ayuda button").addEventListener("click",()=>alert("Mostrando documentaci√≥n..."));document.querySelector("#clientes button").addEventListener("click",()=>{let e=document.querySelector("#nombreContacto"),n=document.querySelector("#emailContacto"),o=document.querySelector("#mensajeContacto"),a=e.value,t=n.value,r=o.value;(!a||!t||!r)&&alert("Por favor, complete todos los campos."),alert(`Mensaje enviado:
     Nombre: ${a}
     Email: ${t}
     Mensaje: ${r}`),e.value="",n.value="",o.value=""});const ee=Symbol.for("CODE by Johan ¬∑ TPV 2025");window[ee]||Object.defineProperty(window,ee,{value:!0,configurable:!1,enumerable:!1,writable:!1});requestIdleCallback(()=>{const n=document.querySelector('form[data-submit="plateMenu"]')?.querySelector('input[type="file"]');if(!n)return;const o=(r,s)=>Object.assign(document.createElement(r),{className:s}),a=o("progress","hidden"),t=o("small","upload-status hidden");a.max=100,n.parentElement.append(a,t),n.addEventListener("change",()=>{if(!n.files.length)return;let r=0;a.value=0,t.textContent="Cargando...",a.classList.remove("hidden"),t.classList.remove("hidden");const s=setInterval(()=>{a.value=r+=5,t.textContent=`Cargando... ${r}%`,r>=100&&(clearInterval(s),t.textContent="Carga completada ‚úî",setTimeout(()=>{a.classList.add("hidden"),t.classList.add("hidden")},1500))},50)})});
